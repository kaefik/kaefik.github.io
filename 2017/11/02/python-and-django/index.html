<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <meta name="yandex-verification" content="f7918c520c4b54dd" />
        <title>Python and Django</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="https://github.com/kaefik">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="/">Общественная записная книжка  <strong>следы для себя и потомков</strong></a></h1>
                <nav><ul>
                </ul>
<form id="search" action"#" onsubmit="javascript:window.open('https://duckduckgo.com/?q='+document.getElementById('keywords').value+'+site:www.kaefik.ru');">
                        <input id="keywords" type="text" />
                    </form>
                </nav>
<div id="submenu">
                    <ul>
                            <li><a href="/category/anime.html">anime</a></li>
                            <li><a href="/category/arduino.html">arduino</a></li>
                            <li><a href="/category/bios.html">bios</a></li>
                            <li><a href="/category/blogger.html">blogger</a></li>
                            <li><a href="/category/c.html">c#</a></li>
                            <li><a href="/category/chromeos.html">chromeos</a></li>
                            <li><a href="/category/clojure.html">clojure</a></li>
                            <li><a href="/category/design.html">design</a></li>
                            <li><a href="/category/docker.html">docker</a></li>
                            <li><a href="/category/emacs.html">emacs</a></li>
                            <li><a href="/category/english.html">english</a></li>
                            <li><a href="/category/familytree.html">familytree</a></li>
                            <li><a href="/category/freepbx.html">freepbx</a></li>
                            <li><a href="/category/game.html">game</a></li>
                            <li><a href="/category/git.html">git</a></li>
                            <li><a href="/category/github-actions.html">github-actions</a></li>
                            <li><a href="/category/go.html">go</a></li>
                            <li><a href="/category/hackintosh.html">hackintosh</a></li>
                            <li><a href="/category/hobby.html">hobby</a></li>
                            <li><a href="/category/internet.html">internet</a></li>
                            <li><a href="/category/java.html">java</a></li>
                            <li><a href="/category/javascript.html">javascript</a></li>
                            <li><a href="/category/lego.html">lego</a></li>
                            <li><a href="/category/linux.html">linux</a></li>
                            <li><a href="/category/lua.html">lua</a></li>
                            <li><a href="/category/machine_learning.html">machine_learning</a></li>
                            <li><a href="/category/main.html">main</a></li>
                            <li><a href="/category/markdown.html">markdown</a></li>
                            <li><a href="/category/miband.html">miband</a></li>
                            <li><a href="/category/minecraft.html">minecraft</a></li>
                            <li><a href="/category/miui.html">miui</a></li>
                            <li><a href="/category/money.html">money</a></li>
                            <li><a href="/category/mongodb.html">mongodb</a></li>
                            <li><a href="/category/mouse.html">mouse</a></li>
                            <li><a href="/category/nano.html">nano</a></li>
                            <li><a href="/category/network.html">network</a></li>
                            <li><a href="/category/openstreetmap.html">openstreetmap</a></li>
                            <li><a href="/category/os.html">os</a></li>
                            <li><a href="/category/otkrytye-dannye.html">открытые данные</a></li>
                            <li><a href="/category/postgis.html">postgis</a></li>
                            <li><a href="/category/postgresql.html">PostgreSQL</a></li>
                            <li><a href="/category/powershell.html">powershell</a></li>
                            <li><a href="/category/programming.html">programming</a></li>
                            <li><a href="/category/projects.html">projects</a></li>
                            <li class="active"><a href="/category/python.html">python</a></li>
                            <li><a href="/category/radio.html">radio</a></li>
                            <li><a href="/category/rest-api.html">rest-api</a></li>
                            <li><a href="/category/rust.html">rust</a></li>
                            <li><a href="/category/sailfish.html">sailfish</a></li>
                            <li><a href="/category/security.html">security</a></li>
                            <li><a href="/category/selenium.html">selenium</a></li>
                            <li><a href="/category/shell.html">shell</a></li>
                            <li><a href="/category/swift.html">swift</a></li>
                            <li><a href="/category/tatar.html">tatar</a></li>
                            <li><a href="/category/ubuntu.html">ubuntu</a></li>
                            <li><a href="/category/upwork.html">upwork</a></li>
                            <li><a href="/category/video.html">video</a></li>
                            <li><a href="/category/vim.html">vim</a></li>
                            <li><a href="/category/voice-assistant.html">voice-assistant</a></li>
                            <li><a href="/category/vpn.html">vpn</a></li>
                            <li><a href="/category/vscode.html">vscode</a></li>
                            <li><a href="/category/web.html">web</a></li>
                            <li><a href="/category/wifi.html">wifi</a></li>
                            <li><a href="/category/windows.html">windows</a></li>
                    </ul>
                <div>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2017/11/02/python-and-django/" rel="bookmark"
           title="Permalink to Python and Django">Python and Django</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>Thu 02 November 2017</span>
<span>| tags: <a href="/tag/programmirovanie.html">программирование</a><a href="/tag/django.html">Django</a><a href="/tag/python.html">python</a><a href="/tag/web.html">web</a></span>
</footer><!-- /.post-info -->      <h2>Полезные ссылки</h2>
<ul>
<li><a href="https://www.djangoproject.com/">https://www.djangoproject.com/</a></li>
<li><a href="https://pythonworld.ru/web/django-ubuntu1604.html">Настраиваем Django + virtualenv + nginx + gunicorn + PostgreSQL + memcached + letsencrypt на Ubuntu 16.04</a></li>
<li><a href="https://django.fun/">Всё, что вы хотели знать о фреймворке Django</a></li>
<li><a href="https://pythonist.ru/best-practices-v-rabote-s-modelyami-django/">Best Practices в работе с моделями Django</a></li>
<li><a href="https://habr.com/ru/post/136784/">Class-based views — зачем и как использовать</a>  - <a href="https://bitbucket.org/martinthenext/geekclub/src/d02276289357/views.py">пример view</a></li>
<li><a href="https://djbook.ru/rel1.7/topics/forms/">https://djbook.ru/rel1.7/topics/forms/</a></li>
</ul>
<p><em>ниже конспект книги Django2.1 - практика создания веб-сайтов на Python. Дронов.</em></p>
<h2>Установка Django</h2>
<div class="highlight"><pre><span></span>pip install django
</pre></div>


<h2>Проект Django</h2>
<div class="highlight"><pre><span></span>django-admin startproject samplesite<span class="sb">`</span>
</pre></div>


<h3>Структура проекта:</h3>
<ul>
<li>
<p>manage.py - модуль который совершает различные действия над преоктом</p>
</li>
<li>
<p>папка samplesite - пакет конфигурации</p>
<ul>
<li>settings.py - настройки проекта</li>
<li>urls.py - модуль с маршрутами уровня проекта</li>
<li>wsgi.py - модуль, связывающий преокт с веб-сервером</li>
</ul>
</li>
</ul>
<p>Отладочный сервер: </p>
<div class="highlight"><pre><span></span>manage.py runserver
</pre></div>


<h3>Приложения - отдельный фрагмент функциональности сайта.</h3>
<p>Приложение это обычный пакет питон.</p>
<p>Создание нового приложения</p>
<div class="highlight"><pre><span></span>manage.py startapp bboard
</pre></div>


<h4>Структура приложений</h4>
<ul>
<li>admin.py - модуль админ настроек и классов-редакторов</li>
<li>apps.py - модуль с настройками приложения</li>
<li>models.py - модуль с моделями</li>
<li>tests.py - модуль с тестирующими процедурами</li>
<li>views.py - модуль с контроллерами</li>
</ul>
<p>Регистрация приложения в проекте:</p>
<p>в файле settings.py переменная INSTALLED_APPS перечисляются все приложения зарегистрированные в проекте и учавствующие в его работе.</p>
<p>INSTALLED_APPS = [</p>
<p>...</p>
<p>'bboard.apps.BboardConfig'</p>
<p>]</p>
<h3>Контроллер - код, запускаемыйв ответ на поступление клиентского запроса, который содержит интернет-адрес опред. формата.</h3>
<p>Контроллер может представлять собой контроллер-функкция или контроллер-класс.</p>
<p>модуль views.py - для хранения кода контроллеров.</p>
<h3>Маршруты и маршрутизатор</h3>
<ul>
<li>объявить связь адреса определнного формата с определенным контроллером - маршрут</li>
<li>оформить все объявленные нами маршруты в виде списка маршрутов</li>
</ul>
<p>urls.py - модуль в котором записываются маршруты уровня проекта</p>
<p><code>from bboard.views import index 
urlpatterns = [
path('bboard', index),
...
]</code></p>
<h3>Модели - это однозначное и исчерпывающее описание сущности, хранящейся в БД в виде класса Python.</h3>
<p>Класс модели описывает таблицу БД,  в которой будет хранится набор сущностей, и содер-т атрибуты класса.</p>
<p>models.py пакета приложения bboard запишем код:</p>
<h3>Миграции - для формирования в БД всех требуемых моделью структур: таблиц, полей, индексов, правил и связей.</h3>
<p><code>manage.py makemigrations bboard</code></p>
<ul>
<li>Посмотрим результирующий SQL код:</li>
</ul>
<p><code>manage.py sqlmigrate bboard 0001</code></p>
<ul>
<li>Выполнение всех миграций всех приложений проекта:</li>
</ul>
<p><code>manage.py migrate</code></p>
<h3>Консоль Django</h3>
<p><code>manage.py shell</code></p>
<p>Работа с моделями:</p>
<p><code>from bboard.models import Bb</code>
<code>b1 = Bb(title='Дaчa', content='Общество "Двухэтажники". Два этажа, кирпич, свет, газ, канализация', price=500000)</code>
<code>b1.save()</code>
<code>b1.pk   #  значение ключевого поля</code></p>
<p>Все классы моделей поддерживают атрибут класса objects - хранит диспетчер записей (экземпляр класса Manager ) - особая структура позволяющая манипулировать всей совокупностью имеющих в модели записей.</p>
<p><code>Bb.objects.create(title='Дoм', content='Трехэтажный, кирпич', price=50000000) # создает новую запись и сохраняет запись и возвр-ет в качестве результата</code></p>
<p><code>`# вывести записи
for  b in Bb.objects.all():  print(b.pk, ': ', b.title)</code></p>
<p>Методы атрубута objects модели:</p>
<ul>
<li><strong>all()</strong> - возвращает набор записей</li>
<li><strong>order_by()</strong> - сортирует записи по значению поля, чье имя указано в параметре</li>
<li><strong>filter()</strong> - выполняет фильтрацию записей по заданным критериям</li>
<li><strong>delete()</strong> - удаляет текущую запись</li>
</ul>
<h3>Шаблоны</h3>
<p>по умолчанию шаблонизатор ищет все шаблоны в папках templates, вложенных в папки пакетов приложений. Сами файлы шаблонов веб старниц должны иметь расширение html.</p>
<h3>Административный сайт Django</h3>
<p><strong>django.contrib.admin</strong> - приложение обеспечивает административный сайт django.</p>
<p>Чтобы успешно задействовать встроенные средства разграничения доступа django, нужно хотя бы один раз произвести операцию по выполнению миграций.</p>
<p>Создание суперпользователя:</p>
<p>manage.py createsuperuser</p>
<p>http://localhost:8000/admin - админ сайт</p>
<p>Чтобы любое приложение появилось в списке админ сайта, его нужно регистрировать - открыть модуль админ настроек admin.py пакета приложения bboard:</p>
<p><code>from .models import Bb
admin.site.register(Bb)</code></p>
<p>models.py в пакете bboard:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bb</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;Товар&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;Объявления&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Объявление&#39;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-published&#39;</span><span class="p">]</span>
</pre></div>


<h3>Редактор модели</h3>
<p>Класс-редактор  объявляется в admin.py пакета приложения.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BbAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">)</span>
    <span class="n">list_display_links</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="p">)</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Bb</span><span class="p">,</span> <span class="n">BbAdmin</span><span class="p">)</span>
</pre></div>


<h2>Связи между моделями</h2>
<p>добавим в models.py</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Rubric</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;Название&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;Рубрики&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Рубрика&#39;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="err">`</span>
</pre></div>


<p>Создадим связь "один-ко-многим" (запись Rubric будет связана с многими записями модели Bb) - для этого в Bb создадим поле rubric</p>
<p><code>rubric = models.ForeignKey('Rubric', null=True, on_delete = models.PROTECT,verbose_name='Рубрика')</code></p>
<p>Класс ForeignKey - поле внешнего ключа в котором будет харнится ключ записи из первичной модели.</p>
<p>Выполним генерирование миграций для внесения изменений в структуры БД:</p>
<p><code>manage.py makemigrations bboard</code></p>
<p><code>manage.py migrate</code></p>
<p>Зарегистрируем новую модель на админсайте в модуле admin.py:</p>
<p><code>from .models import Rubric
admin.site.register(Rubric)</code></p>
<h2>Урл-параметры и параметризированные запросы</h2>
<h2>Обратное разрешение интернет-адресов</h2>
<p>это мы указываем маршрут, формирующий нужный нам адрес, и если это параметризированный маршрут, значения URL-параметров, а django сам генерирует на основе всего этого правильный адрес.</p>
<p>Для этого нужно:</p>
<ul>
<li>модуль urls.py пакета приложения и исправим код, создающий набор маршрутов:</li>
</ul>
<p><code>urlpatterns = [
      path('&lt;int:rubric_id&gt;/', by_rubric, name = 'by_rubric'),
      path('', index, name = 'index'),]</code></p>
<p>имя маршрута указывается в именованном параметре name функции path()</p>
<ul>
<li>используем для адреса в гиперссылках тегов шаблонизатора url:</li>
</ul>
<p><code>&lt;a href="/bboard/{{rubric.pk}}/"&gt;</code></p>
<p>замени на</p>
<p><code>&lt;a href=" {% url 'by_rubric' rubric.pk %} "&gt;</code></p>
<h2>Формы, связанные с моделями</h2>
<p>создать модуль forms.py пакета приложения:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">ModelForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Bb</span>
<span class="k">class</span> <span class="nc">BbForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Bb</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;rubric&#39;</span><span class="p">)</span>
</pre></div>


<h3>Контроллеры-классы</h3>
<p>в модуле views.py в пакете приложения:</p>
<hr>
<h2>Модели: базовые инструменты</h2>
<p><strong>Интернет-адрес модели</strong> - интернет-адрес, указывающий на конкретную запись модели.</p>
<p>Способы формирования интернет-адрес:</p>
<ul>
<li><strong>декларативный</strong> (описываем в настройках проекта в параметре ABSOLUTE_URL_OVERRIDES в виде словаря питон)</li>
</ul>
<p>Например,</p>
<p><code>ABSOLUTE_URL_OVERRIDES = ( 'bboard.rubric': lambda rec: "/bboard/%s/ % rec.pk")</code></p>
<p>в код шаблона достаточно вставить вызов метода get_absolute_url():</p>
<p><code>&lt;a href="{{ rubric.get_absolute_url  }}"&gt; {{ rubric.name }} &lt;/a&gt;</code></p>
<ul>
<li><strong>императивный</strong> - непосредственное переопределения метода get_absolute_url() в классе модели.</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Rubric</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;/bboard/</span><span class="si">%s</span><span class="s2">/ &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span>
</pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/oILnur">Twitter</a></li>
                            <li><a href="mailto: ilnursoft@gmail.com">Email</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>