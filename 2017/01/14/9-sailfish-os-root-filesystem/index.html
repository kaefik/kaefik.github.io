<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="utf-8" />
        <meta name="yandex-verification" content="f7918c520c4b54dd" />
        <title>9. Создание Sailfish OS root filesystem</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="https://github.com/kaefik">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="/">Общественная записная книжка  <strong>следы для себя и потомков</strong></a></h1>
                <nav><ul>
                </ul>
<form id="search" action"#" onsubmit="javascript:window.open('https://duckduckgo.com/?q='+document.getElementById('keywords').value+'+site:www.kaefik.ru');">
                        <input id="keywords" type="text" />
                    </form>
                </nav>
<div id="submenu">
                    <ul>
                            <li><a href="/category/anime.html">anime</a></li>
                            <li><a href="/category/arduino.html">arduino</a></li>
                            <li><a href="/category/bios.html">bios</a></li>
                            <li><a href="/category/blogger.html">blogger</a></li>
                            <li><a href="/category/chromeos.html">chromeos</a></li>
                            <li><a href="/category/clojure.html">clojure</a></li>
                            <li><a href="/category/design.html">design</a></li>
                            <li><a href="/category/docker.html">docker</a></li>
                            <li><a href="/category/emacs.html">emacs</a></li>
                            <li><a href="/category/english.html">english</a></li>
                            <li><a href="/category/freepbx.html">freepbx</a></li>
                            <li><a href="/category/game.html">game</a></li>
                            <li><a href="/category/git.html">git</a></li>
                            <li><a href="/category/go.html">go</a></li>
                            <li><a href="/category/hackintosh.html">hackintosh</a></li>
                            <li><a href="/category/hobby.html">hobby</a></li>
                            <li><a href="/category/internet.html">internet</a></li>
                            <li><a href="/category/javascript.html">javascript</a></li>
                            <li><a href="/category/lego.html">lego</a></li>
                            <li><a href="/category/linux.html">linux</a></li>
                            <li><a href="/category/lua.html">lua</a></li>
                            <li><a href="/category/machine_learning.html">machine_learning</a></li>
                            <li><a href="/category/main.html">main</a></li>
                            <li><a href="/category/markdown.html">markdown</a></li>
                            <li><a href="/category/miband.html">miband</a></li>
                            <li><a href="/category/minecraft.html">minecraft</a></li>
                            <li><a href="/category/miui.html">miui</a></li>
                            <li><a href="/category/money.html">money</a></li>
                            <li><a href="/category/mongodb.html">mongodb</a></li>
                            <li><a href="/category/mouse.html">mouse</a></li>
                            <li><a href="/category/network.html">network</a></li>
                            <li><a href="/category/openstreetmap.html">openstreetmap</a></li>
                            <li><a href="/category/os.html">os</a></li>
                            <li><a href="/category/otkrytye-dannye.html">открытые данные</a></li>
                            <li><a href="/category/postgis.html">postgis</a></li>
                            <li><a href="/category/postgresql.html">PostgreSQL</a></li>
                            <li><a href="/category/powershell.html">powershell</a></li>
                            <li><a href="/category/programming.html">programming</a></li>
                            <li><a href="/category/projects.html">projects</a></li>
                            <li><a href="/category/python.html">python</a></li>
                            <li><a href="/category/radio.html">radio</a></li>
                            <li><a href="/category/rest-api.html">rest-api</a></li>
                            <li><a href="/category/rust.html">rust</a></li>
                            <li class="active"><a href="/category/sailfish.html">sailfish</a></li>
                            <li><a href="/category/security.html">security</a></li>
                            <li><a href="/category/selenium.html">selenium</a></li>
                            <li><a href="/category/shell.html">shell</a></li>
                            <li><a href="/category/swift.html">swift</a></li>
                            <li><a href="/category/tatar.html">tatar</a></li>
                            <li><a href="/category/upwork.html">upwork</a></li>
                            <li><a href="/category/video.html">video</a></li>
                            <li><a href="/category/vim.html">vim</a></li>
                            <li><a href="/category/voice-assistant.html">voice-assistant</a></li>
                            <li><a href="/category/vscode.html">vscode</a></li>
                            <li><a href="/category/web.html">web</a></li>
                            <li><a href="/category/wifi.html">wifi</a></li>
                            <li><a href="/category/windows.html">windows</a></li>
                    </ul>
                <div>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2017/01/14/9-sailfish-os-root-filesystem/" rel="bookmark"
           title="Permalink to 9. Создание Sailfish OS root filesystem">9.  Создание Sailfish OS root filesystem</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>Sat 14 January 2017</span>
<span>| tags: <a href="/tag/asus.html">asus</a><a href="/tag/porting.html">porting</a><a href="/tag/sailfish.html">sailfish</a><a href="/tag/z00l.html">z00l</a></span>
</footer><!-- /.post-info -->      <h2>Создание и настройка Kickstart файл</h2>
<p>The kickstart file is already generated by the build_packages.sh script, during droid-configs build, using ssuks, which is part of the SSU utility:</p>
<div class="highlight"><pre><span></span>MER_SDK $
hadk
<span class="nb">cd</span> <span class="nv">$ANDROID_ROOT</span>
mkdir -p tmp
<span class="nv">HA_REPO</span><span class="o">=</span><span class="s2">&quot;repo --name=adaptation0-</span><span class="nv">$DEVICE</span><span class="s2">-@RELEASE@&quot;</span>
<span class="nv">KS</span><span class="o">=</span><span class="s2">&quot;Jolla-@RELEASE@-</span><span class="nv">$DEVICE</span><span class="s2">-@ARCH@.ks&quot;</span>
sed -e <span class="se">\</span>
<span class="s2">&quot;s|^</span><span class="nv">$HA_REPO</span><span class="s2">.*</span>$<span class="s2">|</span><span class="nv">$HA_REPO</span><span class="s2"> --baseurl=file://</span><span class="nv">$ANDROID_ROOT</span><span class="s2">/droid-local-repo/</span><span class="nv">$DEVICE</span><span class="s2">|&quot;</span> <span class="se">\</span>
<span class="nv">$ANDROID_ROOT</span>/hybris/droid-configs/installroot/usr/share/kickstarts/<span class="nv">$KS</span> <span class="se">\</span>
&gt; tmp/<span class="nv">$KS</span>
</pre></div>


<h2>Создание локальный репозиторий шаблонов</h2>
<p>Add/update metadata about patterns using this script (NB: it will fail with a non-critical Exception AttributeError: "’NoneType... error):</p>
<div class="highlight"><pre><span></span>MER_SDK $
hadk
<span class="nb">cd</span> <span class="nv">$ANDROID_ROOT</span>
hybris/droid-configs/droid-configs-device/helpers/process_patterns.sh
</pre></div>


<h2>Building the Image with MIC</h2>
<p>Вот тут можно посмотреть доступные версии Sailfish OS</p>
<div class="highlight"><pre><span></span>MER_SDK $
<span class="c1"># Set the version of your choosing, latest is strongly preferred</span>
<span class="c1"># (check with &quot;Sailfish OS version&quot; link above)</span>
<span class="nv">RELEASE</span><span class="o">=</span><span class="m">2</span>.0.5.6
<span class="c1"># EXTRA_NAME adds your custom tag. It doesn&#39;t support &#39;.&#39; dots in it!</span>
<span class="nv">EXTRA_NAME</span><span class="o">=</span>-my1
</pre></div>


<div class="highlight"><pre><span></span>sudo mic create fs --arch <span class="nv">$PORT_ARCH</span> --debug --tokenmap<span class="o">=</span>ARCH:<span class="nv">$PORT_ARCH</span>,RELEASE:<span class="nv">$RELEASE</span>,EXTRA_NAME:<span class="nv">$EXTRA_NAME</span> --record-pkgs<span class="o">=</span>name,url --outdir<span class="o">=</span>sfe-<span class="nv">$DEVICE</span>-<span class="nv">$RELEASE$EXTRA_NAME</span> --pack-to<span class="o">=</span>sfe-<span class="nv">$DEVICE</span>-<span class="nv">$RELEASE$EXTRA_NAME</span>.tar.bz2 <span class="nv">$ANDROID_ROOT</span>/tmp/Jolla-@RELEASE@-<span class="nv">$DEVICE</span>-@ARCH@.ks
</pre></div>


<p>в итоге получим файл прошивки через recovery.</p>
<p><strong>Важно!</strong> параметра --runtime=native  здесь нет, который указан в главе 8.5 в офиц документации по портированию  (версии 1.1.2 от 16.06.2016) так как с этим параметром выдает ошибку.</p>
<p><strong>Примечания:</strong></p>
<div class="highlight"><pre><span></span>MER_SDK $
sb2 -t <span class="nv">$VENDOR</span>-<span class="nv">$DEVICE</span>-<span class="nv">$PORT_ARCH</span> -R -m sdk-install ssu ar common http://repo.merproject.org/obs/nemo:/devel:/hw:/common/sailfish_latest_armv7hl/
Also add the same repo to .ks file before building the installation package with mic
Run the following commands before chapter <span class="m">8</span>.3 of HADK pdf
MER_SDK $
<span class="nb">cd</span> <span class="nv">$ANDROID_ROOT</span>
<span class="nv">MOBS_URI</span><span class="o">=</span><span class="s2">&quot;http://repo.merproject.org/obs&quot;</span>
<span class="nv">HA_REPO</span><span class="o">=</span><span class="s2">&quot;repo --name=adaptation0-</span><span class="nv">$DEVICE</span><span class="s2">-@RELEASE@&quot;</span>
<span class="nv">HA_REPO1</span><span class="o">=</span><span class="s2">&quot;repo --name=common \</span>
<span class="s2">--baseurl=</span><span class="nv">$MOBS_URI</span><span class="s2">/nemo:/devel:/hw:/common/sailfish_latest_@ARCH@/&quot;</span>
hybris/droid-configs/droid-configs-device/helpers/process_patterns.sh

If MIC fails with 
RuntimeError: Invalid runmode: native 
remove <span class="sb">`</span>--runtime<span class="o">=</span>native<span class="sb">`</span> from mic <span class="nb">command</span> args
</pre></div>


<ul>
<li>Verbose: running command: "/bin/umount -l /var/tmp/mic/imgcreate-uN75dq/install_root//sys" </li>
</ul>
<p><code>Error: Traceback (most recent call last): 
    File "/usr/bin/mic", line 217, in &lt;module&gt; 
      sys.exit(mic.main()) 
    File "/usr/lib/python2.7/site-packages/mic/utils/cmdln.py", line 257, in main 
      return self.cmd(args) 
    File "/usr/lib/python2.7/site-packages/mic/utils/cmdln.py", line 280, in cmd 
      retval = self.onecmd(argv) 
    File "/usr/lib/python2.7/site-packages/mic/utils/cmdln.py", line 412, in onecmd 
      return self._dispatch_cmd(handler, argv) 
    File "/usr/lib/python2.7/site-packages/mic/utils/cmdln.py", line 1084, in _dispatch_cmd 
      return handler(argv) 
    File "/usr/bin/mic", line 86, in do_create 
      cr.main(argv[1:]) 
    File "/usr/lib/python2.7/site-packages/mic/creator.py", line 266, in main 
      return self.cmd(args) 
    File "/usr/lib/python2.7/site-packages/mic/utils/cmdln.py", line 280, in cmd 
      retval = self.onecmd(argv) 
    File "/usr/lib/python2.7/site-packages/mic/utils/cmdln.py", line 412, in onecmd 
      return self._dispatch_cmd(handler, argv) 
    File "/usr/lib/python2.7/site-packages/mic/utils/cmdln.py", line 1100, in _dispatch_cmd 
      return handler(argv[0], opts, *args) 
    File "/usr/lib/mic/plugins/imager/fs_plugin.py", line 62, in do_create 
      creator.install() 
    File "/usr/lib/python2.7/site-packages/mic/imager/baseimager.py", line 978, in install 
      self.__deref_groups(pkg_manager) 
    File "/usr/lib/python2.7/site-packages/mic/imager/baseimager.py", line 849, in __deref_groups 
      deref = pkg_manager.derefGroups() 
    File "/usr/lib/mic/plugins/backend/zypppkgmgr.py", line 284, in derefGroups 
      self.buildTransaction() 
    File "/usr/lib/mic/plugins/backend/zypppkgmgr.py", line 624, in buildTransaction 
      % len(probs)) 
  RepoError: &lt;repo&gt;found 1 resolver problem, abort!</code></p>
<p><strong>Решение</strong></p>
<ul>
<li>
<p>For  devices with /dev/block/platform/msm_sdcc.1/by-name/ paths (msm_sdcc.1  can be different) add to $ANDROID_ROOT/rpm/ these paths and files with  contents, and it most probably will help (but still paste your diff to  the IRC channel): </p>
</li>
<li>
<p>https://github.com/mer-hybris-kis3/droid-config-kis3/blob/master/sparse/lib/udev/platform-device </p>
</li>
<li>https://github.com/mer-hybris-kis3/droid-config-kis3/blob/master/sparse/lib/udev/rules.d/998-droid-system.rules </li>
</ul>
<p>Изменить файлы в папке $ANDROID_ROOT/hybris/droid-configs/droid-configs-device/sparse/lib/udev  согласно ссылков выше.</p>
<p>```bash
  cat 998-droid-system.rules
  SUBSYSTEM=="graphics", SYMLINK+="$env{SUBSYSTEM}/%k"
  SUBSYSTEM=="block", SYMLINK+="$env{SUBSYSTEM}/%k"
  SUBSYSTEM=="drm", SYMLINK+="dri/%k"
  SUBSYSTEM=="oncrpc", SYMLINK+="$env{SUBSYSTEM}/%k"
  SUBSYSTEM=="adsp", SYMLINK+="$env{SUBSYSTEM}/%k"
  SUBSYSTEM=="msm_camera", SYMLINK+="$env{SUBSYSTEM}/%k"
  SUBSYSTEM=="mtd", SYMLINK+="$env{SUBSYSTEM}/%k"
  SUBSYSTEM=="block", SYMLINK+="$env{SUBSYSTEM}/%k"
  SUBSYSTEM=="misc", KERNEL=="log_events", SYMLINK+="alog/events"
  SUBSYSTEM=="misc", KERNEL=="log_radio", SYMLINK+="alog/radio"
  SUBSYSTEM=="misc", KERNEL=="log_system", SYMLINK+="alog/system"
  SUBSYSTEM=="misc", KERNEL=="log_main", SYMLINK+="alog/main"</p>
<p>ENV{ID_PART_ENTRY_SCHEME}=="gpt", ENV{ID_PART_ENTRY_NAME}=="?*", IMPORT{program}="/bin/sh /lib/udev/platform-device $env{DEVPATH}", SYMLINK+="block/bootdevice/by-name/$env{ID_PART_ENTRY_NAME}"ilnur@ubuntu:~/to/mer/android/droid/hybris/droid-configs/droid-configs-device/sparse/lib/udev/rules.d$
  ```</p>
<ul>
<li><strong>Warning:</strong> repo problem: pattern:jolla-configuration-Z00L-1-1.noarch requires pattern:jolla-hw-adaptation-Z00L, but this requirement cannot be provided, uninstallable providers: pattern:jolla-hw-adaptation-Z00L-1-1.noarch[adaptation0-Z00L-2.0.5.6]</li>
</ul>
<div class="highlight"><pre><span></span>MER_SDK $
<span class="nb">cd</span> <span class="nv">$ANDROID_ROOT</span>
<span class="nv">MOBS_URI</span><span class="o">=</span><span class="s2">&quot;http://repo.merproject.org/obs&quot;</span>
<span class="nv">HA_REPO</span><span class="o">=</span><span class="s2">&quot;repo --name=adaptation0-</span><span class="nv">$DEVICE</span><span class="s2">-@RELEASE@&quot;</span>
<span class="nv">HA_REPO1</span><span class="o">=</span><span class="s2">&quot;repo --name=common --baseurl=</span><span class="nv">$MOBS_URI</span><span class="s2">/nemo:/devel:/hw:/common/sailfish_latest_@ARCH@/&quot;</span>
sed -i -e <span class="s2">&quot;/^</span><span class="nv">$HA_REPO</span><span class="s2">.*</span>$<span class="s2">/a</span><span class="nv">$HA_REPO1</span><span class="s2">&quot;</span> tmp/Jolla-@RELEASE@-<span class="nv">$DEVICE</span>-@ARCH@.ks
</pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/oILnur">Twitter</a></li>
                            <li><a href="mailto: ilnursoft@gmail.com">Email</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>